<ui:composition template="/WEB-INF/templates/layout.xhtml"
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
         
     xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
     <ui:define name="content">
         <style>
             .ui-fileupload-choose{
                 overflow: visible!important;
             }
             #dlg1{
                position:fixed!important;
            }
             #modalNewHE{
                position:fixed!important;
            }
             #modalNewRD{
                position:fixed!important;
            }
             #modalNewDR{
                position:fixed!important;
            }
             
         </style> 
            <p:dialog header="Foto #{myBean.newReport}" widgetVar="dlg1" id="dlg1" modal="true" height="auto" width="auto">
            <h:form id="foto" enctype="multipart/form-data">
                   <p:fileUpload  id="des" value="#{myBean.archivo}" 
                      skinSimple="true" label="Foto"
                      disabled="false"
                      allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
                     mode="advanced" 
                     sizeLimit="3000000"
                      multiple="false"
                      fileLimit="2"
                      uploadLabel="Cargar"
                      cancelLabel="Cancelar"
                      fileUploadListener="#{myBean.fileUploadListener}"
                      update=":newinc"
                      oncomplete="PF(dlg1).hide()"
                      />
                 
                </h:form>
            <h:form id="mensaje">
               
                <h:panelGrid columns="2" width="500">
                    <h:outputText value="Foto: "/>
                    
                </h:panelGrid>
                <p:separator></p:separator>
                <img  style="padding-bottom: 10px;border: white;border-style: solid; border-radius: 20px 3px; width: 80px;" 
                      src="/img/#{myBean.newReport}.jpg" 
                      onerror="this.src='images/noprofile.jpeg'"  
                      alt="Foto"/>
            </h:form>
            
       </p:dialog>
         
         
         <p:dialog id="modalNewHE" header="Añadir Informe Técnico" widgetVar="newHE" modal="true" >
              <p:growl id="growlA" sticky="true" showDetail="true" life="3000" />
                <h:outputText value="Añada los campos, guarde y suba el archivo." />
                
                <h:form>
                    <h:panelGrid columns="3"  border="0" style="width: 100%;">

                        <h:outputText value="Título Archivo"/>
                        <p:inputText style="width: 250px;" value="#{myBean.newReport.titulo}" id="heano" required="true" requiredMessage="Título Obligatorio" placeholder="Informe Técnico nº (por ejemplo)"/>
                             <p:message for="heano" />
                        <h:outputText value="Mes/Año"/>
                        <p:calendar style="width: 250px;" value="#{myBean.newReport.mesano}"  disabled="false" id="henombres" converterMessage="Fecha erronea"
                                                                pattern="MMM/yyyy" 
                                                                navigator="true"
                                                                required="true"
                                                                readonly="false"
                                                                requiredMessage="Falta Mes y Año del documento"
                                                                locale="es"
                                                                >
                                                            </p:calendar>
                             <p:message for="henombres" />
                       
                        
                        
                    </h:panelGrid>
                    <p:separator/>
                    <!-- oncomplete="if ( numeral {not facesContext.validationFailed})PF('newHE').hide()"-->
                    <p:commandButton action="#{myBean.registraInforme(1)}" value="Guardar" 
                                 icon="fa fa-fw fa-save" styleClass="w3-btn botones" 
                                 update="@(form) informe1"
                                 style="    background: #2196F3;    color: white;"
                                 
                                 >
                    </p:commandButton>
                </h:form>
                <h:form id="informe1" enctype="multipart/form-data">
                   <p:fileUpload  id="inf1" value="#{myBean.archivo}" 
                      skinSimple="true" label="PDF"
                      disabled="#{myBean.newReport.id==null}"
                      allowTypes="/(\.|\/)(pdf)$/" 
                     mode="advanced" 
                     sizeLimit="3000000"
                      multiple="false"
                      fileLimit="2"
                      uploadLabel="Cargar"
                      cancelLabel="Cancelar"
                      fileUploadListener="#{myBean.fileUploadListener}"
                      update=":newinc"
                      oncomplete="if(#{not facesContext.validationFailed})PF('newHE').hide()"
                      />
                 
                </h:form>
                
                
                
                
            </p:dialog> 
         <p:dialog id="modalNewRD" header="Añadir Registro Asistencia" widgetVar="newRD" modal="true" >
              <p:growl id="growlB" sticky="true" showDetail="true" life="3000" />
                <h:outputText value="Llene todos los campos." />
                
                
                <h:form>
                    <h:panelGrid columns="3"  border="0" style="width: 100%;">

                        <h:outputText value="Título Archivo"/>
                        <p:inputText style="" value="#{myBean.newReport.titulo}" id="t2" required="true" requiredMessage="Título Obligatorio" placeholder="Informe Técnico nº (por ejemplo)"/>
                             <p:message for="t2" />
                        <h:outputText value="Mes/Año"/>
                        <p:calendar value="#{myBean.newReport.mesano}"  disabled="false" id="ma2" converterMessage="Fecha erronea"
                                                                pattern="MMM/yyyy" 
                                                                navigator="true"
                                                                required="true"
                                                                readonly="false"
                                                                requiredMessage="Falta Mes y Año del documento"
                                                                locale="es"
                                                                >
                                                            </p:calendar>
                             <p:message for="ma2" />
                       
                        
                        
                    </h:panelGrid>
                    <p:separator/>
                    <!-- oncomplete="if ( numeral {not facesContext.validationFailed})PF('newHE').hide()"-->
                    <p:commandButton action="#{myBean.registraInforme(2)}" value="Guardar" 
                                 icon="fa fa-fw fa-save" styleClass="w3-btn botones" 
                                 update="@(form) informe2"
                                 style="    background: #2196F3;    color: white;"
                                 
                                 >
                    </p:commandButton>
                </h:form>
                <h:form id="informe2" enctype="multipart/form-data">
                   <p:fileUpload  id="inf2" value="#{myBean.archivo}" 
                      skinSimple="true" label="PDF"
                      disabled="#{myBean.newReport.id==null}"
                      allowTypes="/(\.|\/)(pdf)$/" 
                     mode="advanced" 
                     sizeLimit="3000000"
                      multiple="false"
                      fileLimit="2"
                      uploadLabel="Cargar"
                      cancelLabel="Cancelar"
                      fileUploadListener="#{myBean.fileUploadListener}"
                      update=":newinc"
                      oncomplete="if(#{not facesContext.validationFailed})PF('newRD').hide()"
                      />
                 
                </h:form>
                
            </p:dialog> 
         <p:dialog id="modalNewDR" header="Añadir Pago IESS" widgetVar="newDR" modal="true" >
              <p:growl id="growlC" sticky="true" showDetail="true" life="3000" />
                <h:outputText value="Llene todos los campos." />
                
                
                 <h:form>
                    <h:panelGrid columns="3"  border="0" style="width: 100%;">

                        <h:outputText value="Detalles Archivo"/>
                        <p:inputText style="width: 350px;" value="#{myBean.newReport.titulo}" id="tiess" required="true" requiredMessage="Título Obligatorio" placeholder="Informe Técnico nº (por ejemplo)"/>
                             <p:message for="tiess" />
                        <h:outputText value="Mes/Año"/>
                        <p:calendar style="width: 350px;" value="#{myBean.newReport.mesano}"  disabled="false" id="maiess" converterMessage="Fecha erronea"
                                                                pattern="MMM/yyyy" 
                                                                navigator="true"
                                                                required="true"
                                                                readonly="false"
                                                                requiredMessage="Falta Mes y Año del documento"
                                                                locale="es"
                                                                >
                                                            </p:calendar>
                             <p:message for="maiess" />
                         <h:outputText value="Atleta"/>
                         <p:selectOneMenu id="persona" required="true" requiredMessage="Selecione Deportista" value="#{myBean.newReport.pertenece}" styleClass="menuSelect" panelStyleClass="panel">
                                                        <f:selectItem itemLabel="Atleta"/>
                                                        <f:selectItems value="#{myBean.listaPersonas}" var="per" itemLabel="#{per.depapellido} #{per.depnombre}" itemValue="#{per.iddep}" />
                                                    </p:selectOneMenu>
                        <p:message for="persona" />
                        
                        
                    </h:panelGrid>
                    <p:separator/>
                    <!-- oncomplete="if ( numeral {not facesContext.validationFailed})PF('newHE').hide()"-->
                    <p:commandButton action="#{myBean.registraInforme(3)}" value="Guardar" 
                                 icon="fa fa-fw fa-save" styleClass="w3-btn botones" 
                                 update="@(form) informe3"
                                 style="    background: #2196F3;    color: white;"
                                 
                                 >
                    </p:commandButton>
                </h:form>
                <h:form id="informe3" enctype="multipart/form-data">
                   <p:fileUpload  id="inf3" value="#{myBean.archivo}" 
                      skinSimple="true" label="PDF"
                      disabled="#{myBean.newReport.id==null}"
                      allowTypes="/(\.|\/)(pdf)$/" 
                     mode="advanced" 
                     sizeLimit="3000000"
                      multiple="false"
                      fileLimit="2"
                      uploadLabel="Cargar"
                      cancelLabel="Cancelar"
                      fileUploadListener="#{myBean.fileUploadListener}"
                      update=":newinc"
                      oncomplete="if(#{not facesContext.validationFailed})PF('newDR').hide()"
                      />
                 
                </h:form>
                
            </p:dialog> 
        
         <style>
            .menuSelect .ui-selectonemenu-label { 
                //background: pink;
               
                box-sizing: content-box!important;
            }
            .panel .ui-selectonemenu-list { 
                 //width: 100px;
                //background: green;
            }
            
            .ui-selectonemenu .ui-selectonemenu-trigger {
                  // background-color: red;
                width: auto!important;
            }
            .ui-state-highlight, .ui-widget-content .ui-state-highlight{
                background-image: linear-gradient(to bottom, #f2dede, #254786);
                    background-color: #555;
            }
             
         </style>
         <div class="wrapper row3">
            <main class="clear"> 
                
				<nav id="mainavNO" class="fl_right">
                    <ul class="clear">
                      <li class="active">
                          <h:form>
                                            <p:commandButton  style="background: #4caf50; color: white;" value="Salir" action="#{myBean.logout()}" icon="fa fa-fw fa-external-link" />
                                        </h:form>
                      </li>
                    </ul>
                </nav>
                <div class="btmspace-80 center">
                  <h3 class="nospace">Bienvenidos</h3>
                  <h:outputText value="Usuario con acceso"/>
                </div>
             <!-- InstanceBeginEditable name="EditRegion1" -->
                 
                <h:outputLink value="javascript:void(0)" onclick="PF('dlg').show();" title="login">
                </h:outputLink>
                <p:growl id="growl" sticky="false" showDetail="true" life="500" />
               
                    <h2></h2>     
                    <div id="comments">
                        <ul>
                            <li>
                                <article>
                                    <header>
                                      <address><h2>REPOSITORIO INFORMES</h2></address>
                                    </header>
                                    <div class="comcont">
                                        <div class="one_third first">
                                                        <label for="url"><B> Añada los documentos</B></label>
                                         </div>
                                         <h:form>
                                            <p:commandButton  style="background: #FF9800; color: white; float: right;" value="Regresar"
                                                            action="#{myBean.givmeLink(1)}" icon="fa fa-fw fa-undo" />
                                        </h:form>
                                                  
                                    </div>
                                    <div class="comcont">
                                        <h:form id="newinc" class="container" style="margin-left: 0%; margin-right: 0%; margin-bottom: 0px;">
                                            
                                            
                                            <p:messages id="messages" closable="true" autoUpdate="true">
                                                <p:effect type="puff" event="load" delay="300" />
                                            </p:messages>
                                            <p:panel header="Histórico documental de #{myBean.currentUser.entrenador?'Entrenadores':'Pagos Iess'}" id="cvd" widgetVar="regWidget" style="padding-left: 0%; padding-right: 0%; background-color: rgba(255,255,255,0.5);">
                                                <h:outputText value="#{myBean.currentUser.usuapellidos} #{myBean.currentUser.usunombres}" />
                                                
                                             
                                                
                                                
                                                
                                                
                                               
                                                
                                                
                                                
                                                
                                                
                                                <p:panelGrid style="margin-top:20px" rendered="#{myBean.currentUser.entrenador}">
                                                    <p:row>
                                                            <p:column style="font-weight: bold; text-align: center;">Registro Informes Técnicos</p:column>  
                                                    </p:row>  
                                                    <p:row>
                                                        <p:column>
                                                                <p:commandButton rendered="true" id="nuevoHE" value="Añadir Informe Técnico" 
                                                                        style="color: #2196f3;"
                                                                        onclick="PF('newHE').show()" 
                                                                        icon="fa fa-fw fa-plus" 
                                                                ></p:commandButton>
                                                        </p:column>
                                                    </p:row>
                                                </p:panelGrid>                                                           
                                                <p:dataTable var="he" value="#{myBean.listInfTec}" 
                                                             emptyMessage="No hay registros..." rowIndexVar="index"
                                                             rendered="#{myBean.currentUser.entrenador}">
                                                        <p:column headerText="Nº">
                                                            <h:outputText value="#{index+1}" />
                                                        </p:column>
                                                    <p:column headerText="Título" sortBy="#{he.titulo}">
                                                            <h:outputText value="#{he.titulo}" />
                                                        </p:column>
                                                    <p:column headerText="Mes y Año" sortBy="#{he.mesano}">
                                                            <p:outputLabel value="#{he.mesano}">
                                                             <f:convertDateTime pattern="MMM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                    <p:column headerText="Archivo" sortBy="#{he.archivo}">
                                                            <a target="_blank" href="../imagenes/#{he.archivo}">#{he.archivo}</a>
                                                        </p:column>
                                                        
                                                    <p:column headerText="Fecha de Carga" sortBy="#{he.fechacarga}">
                                                            <p:outputLabel value="#{he.fechacarga}">
                                                             <f:convertDateTime pattern="dd/MM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                        
                                                    </p:dataTable>                          
                                                <p:panelGrid style="margin-top:20px" rendered="#{myBean.currentUser.entrenador}">
                                                    <f:facet name="header">
                                                        <p:row>
                                                            <p:column colspan="9">Registro Asistencia</p:column>
                                                        </p:row>
                                                    </f:facet>
                                                    <p:row>
                                                        <p:column>
                                                                <p:commandButton rendered="true" id="nuevoRD" value="Añadir registro" 
                                                                        style="color: #2196f3;"
                                                                        onclick="PF('newRD').show()" 
                                                                        icon="fa fa-fw fa-plus" 
                                                                ></p:commandButton>
                                                        </p:column>
                                                    </p:row>                                                 
                                                </p:panelGrid>                                                
                                                <p:dataTable var="ra" value="#{myBean.listRegAsist}" emptyMessage="No hay registros..." 
                                                             rowIndexVar="index"
                                                             rendered="#{myBean.currentUser.entrenador}">
                                                        <p:column headerText="Nº">
                                                            <h:outputText value="#{index+1}" />
                                                        </p:column>
                                                    <p:column headerText="Título" sortBy="#{ra.titulo}">
                                                            <h:outputText value="#{ra.titulo}" />
                                                        </p:column>
                                                    <p:column headerText="Mes y Año" sortBy="#{ra.mesano}">
                                                            <p:outputLabel value="#{ra.mesano}">
                                                             <f:convertDateTime pattern="MMM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                    <p:column headerText="Archivo" sortBy="#{ra.archivo}">
                                                            <a target="_blank" href="../imagenes/#{ra.archivo}">#{ra.archivo}</a>
                                                        </p:column>
                                                        
                                                    <p:column headerText="Fecha de Carga" sortBy="#{ra.fechacarga}">
                                                            <p:outputLabel value="#{ra.fechacarga}">
                                                             <f:convertDateTime pattern="dd/MM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                </p:dataTable>
                                                <p:panelGrid style="margin-top:20px" rendered="#{!myBean.currentUser.entrenador}">
                                                    <f:facet name="header">
                                                        <p:row>
                                                            <p:column colspan="6">Pagos IESS</p:column>
                                                        </p:row>
                                                    </f:facet>
                                                    <p:row>
                                                        <p:column>
                                                                <p:commandButton rendered="true" id="nuevoDR" value="Añadir Pago IESS" 
                                                                        style="color: #2196f3;"
                                                                        onclick="PF('newDR').show()" 
                                                                        icon="fa fa-fw fa-plus" 
                                                                ></p:commandButton>
                                                        </p:column>
                                                    </p:row>
                                                </p:panelGrid>
                                                <p:dataTable var="iess" value="#{myBean.listPagoIess}" emptyMessage="No hay registros..." 
                                                             rowIndexVar="index"
                                                             rendered="#{!myBean.currentUser.entrenador}">
                                                        <p:column headerText="Nº">
                                                            <h:outputText value="#{index+1}" />
                                                        </p:column>
                                                    <p:column headerText="Título" sortBy="#{iess.titulo}">
                                                            <h:outputText value="#{iess.titulo}" />
                                                        </p:column>
                                                    <p:column headerText="Atleta" sortBy="#{myBean.searchIessAtleta(iess.pertenece)}">
                                                        <h:outputText value="#{myBean.searchIessAtleta(iess.pertenece)}" />
                                                        </p:column>
                                                    <p:column headerText="Mes y Año" sortBy="#{iess.mesano}">
                                                            <p:outputLabel value="#{iess.mesano}">
                                                             <f:convertDateTime pattern="MMM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                    <p:column headerText="Archivo" sortBy="#{iess.archivo}">
                                                            <a target="_blank" href="../imagenes/#{iess.archivo}">#{iess.archivo}</a>
                                                        </p:column>
                                                        
                                                    <p:column headerText="Fecha de Carga" sortBy="#{iess.fechacarga}">
                                                            <p:outputLabel value="#{iess.fechacarga}">
                                                             <f:convertDateTime pattern="dd/MM/yyyy" />
                                                          </p:outputLabel>
                                                        </p:column>
                                                        
                                                </p:dataTable>
                                                <p:separator />

                                               
                                                <p:separator />
                                                
                                               
                                            </p:panel>
                </h:form>     
                                    </div>
                                </article>
                            </li>
                            <li>
                              <article>
                                    <div class="comcont">
                                       <div class="scrollable">
                                          <div id="datos"></div>
                                       </div>
                                    </div>
                              </article>
                            </li>
                        </ul>
                    </div>
                    <hr />
                 
                <script type="text/javascript">
                    function handleLoginRequest(xhr, status, args) {
                        if(args.validationFailed || !args.loggedIn) {
                            PF('dlg').jq.effect("shake", {times:5}, 100);
                            //location.reload(); 
                            //window.location.replace(window.location.href);
                        }
                        else {
                            PF('dlg').hide();
                            $('#loginLink').fadeOut();
                        }
                    }
                </script>
                  <!-- InstanceEndEditable -->
                <div class="clear"></div>
            </main>
        </div>
         
         <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
                                     <p:dialog id="dgl" widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                                         <h3>Procesando...</h3>
                                         <img  src="images/bar.gif"/>
                                     </p:dialog>
         
         
         
         
         
         
         
     </ui:define>
</ui:composition>